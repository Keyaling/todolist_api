import{d as N,u as O,r as g,h as I,S as n,g as c,i as L,c as a,a as e,t as u,j as k,k as Q,v as S,n as x,F as E,l as K,o as l}from"./index-CB6Os2dO.js";const F={id:"todoListPage",class:"bg-half"},V=e("h1",null,[e("a",{href:"#"},"ONLINE TODO LIST")],-1),P={class:"todo_sm"},R={href:"#"},U={class:"container todoListPage vhContainer"},W={class:"todoList_Content"},D={class:"inputBox"},G=e("i",{class:"fa fa-plus"},null,-1),j=[G],q={key:0,class:"blank_content"},H=e("h2",null,"目前尚無待辦事項",-1),X=e("img",{src:"https://s3-alpha-sig.figma.com/img/7465/9ab1/8911ab6dcbda98df56e26aa23c6643ac?Expires=1725840000&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=BmQcA76gk9l2y3s7vsRdmBkTjO8lYemchgz2fvvQqd6vEzKKoIKpTWxR5Iz6gkNQvICzQzSjfpXqRAiCmhCNaAQ6Nh7~7r0wEuxTCVOUzW8CGb7FlmUhs6GheqqJYxcxGV-lXtINwxY64LwHtFEXuKVwtdn2SiYuHNupWiTlTN77sAjR8vDZyjkSsuq4CXGVik3UGeHkJnsNAa-6eQ~QB-7HcW4F914N17QBifY47i8f~-AxsoBQ4OAmEM7uO-Jv1g1Wu7FEvy8-otCk79O2XZv6BpUsFTUyvDTR113J0ksi79QkwpeD8I6W4wZ1NxKwmvrxER6-COl7hStdVP1-QQ__",alt:""},null,-1),Y=[H,X],J={key:1,class:"todoList_list"},M={class:"todoList_tab"},Z={class:"todoList_items"},ee={class:"todoList_item"},te={class:"todoList_label"},se=["onClick","checked"],oe=["onClick"],ne=e("i",{class:"fa fa-times"},null,-1),ie=[ne],ae={key:0,class:"todoList_statistics"},le={key:1,class:"todoList_statistics"},re={key:2,class:"todoList_statistics"},d="https://todolist-api.hexschool.io",de={__name:"TodoList",setup(ce){const T=N.useLoading({color:"#ffd370",backgroundColor:"white",opacity:.8,blur:"10px",zIndex:9999}),w=O(),y=g({nickname:"",uid:""}),r=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");I(async()=>{if(!r){n.fire({icon:"error",title:"您尚無資格登入",text:"Something went wrong!"}),w.push("/login");return}const s=T.show({canCancel:!0});try{const t=await c.get(`${d}/users/checkout`,{headers:{Authorization:r}});y.value=t.data,s.hide(),_()}catch{n.fire({icon:"error",title:"驗證失效",text:"Something went wrong!"}),setTimeout(()=>{w.push("/login")},3e3)}});const h=g([]),_=async()=>{try{const s=await c.get(`${d}/todos`,{headers:{Authorization:r}});h.value=s.data.data}catch(s){n.fire(s.response.data.message)}},v=g(""),$=async()=>{if(v.value===""){n.fire("清單內容不能為空的");return}const s={content:v.value};try{const t=await c.post(`${d}/todos/`,s,{headers:{Authorization:r}});n.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:500,timerProgressBar:!0,didOpen:C=>{C.onmouseenter=n.stopTimer,C.onmouseleave=n.resumeTimer}}).fire({icon:"success",title:"已新增代辦清單"})}catch(t){n.fire(t.response.data.message)}v.value="",_(),m("all")},A=async s=>{const t=T.show({canCancel:!0});try{await c.patch(`${d}/todos/${s}/toggle`,{},{headers:{Authorization:r}}),setTimeout(()=>{t.hide()},100)}catch(o){n.fire(o.response.data.message)}_()},b=async s=>{try{await c.delete(`${d}/todos/${s}`,{headers:{Authorization:r}}),n.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:500,timerProgressBar:!0,didOpen:o=>{o.onmouseenter=n.stopTimer,o.onmouseleave=n.resumeTimer}}).fire({icon:"success",title:"已刪除代辦清單"})}catch(t){n.fire(t.response.data.message)}_()},i=g("all"),m=s=>{i.value=s},p=L(()=>i.value==="unfinished"?h.value.filter(s=>s.status===!1):i.value==="done"?h.value.filter(s=>s.status===!0):h.value),f=L(()=>p.value.filter(s=>s.status===!1).length),z=async()=>{const s=T.show({canCancel:!0});try{const t=await c.post(`${d}/users/sign_out`,{},{headers:{Authorization:r}});s.hide(),n.fire(t.data.message)}catch(t){n.fire("登出失敗",`${t}`)}document.cookie="customTodoToken=",y.value="",setTimeout(()=>{w.push("/login")},1500)};return(s,t)=>(l(),a("div",F,[e("nav",null,[V,e("ul",null,[e("li",P,[e("a",R,[e("span",null,u(y.value.nickname)+"的代辦",1)])]),e("li",null,[e("a",{href:"#",onClick:k(z,["prevent"])},"登出")])])]),e("div",U,[e("div",W,[e("div",D,[Q(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o)},null,512),[[S,v.value]]),e("button",{href:"#",onClick:$},j)]),h.value.length===0?(l(),a("div",q,Y)):(l(),a("div",J,[e("ul",M,[e("li",null,[e("a",{href:"#",class:x({active:i.value==="all"}),onClick:t[1]||(t[1]=k(o=>m("all"),["prevent"]))},"全部",2)]),e("li",null,[e("a",{href:"#",class:x({active:i.value==="unfinished"}),onClick:t[2]||(t[2]=k(o=>m("unfinished"),["prevent"]))},"待完成",2)]),e("li",null,[e("a",{href:"#",class:x({active:i.value==="done"}),onClick:t[3]||(t[3]=k(o=>m("done"),["prevent"]))},"已完成",2)])]),e("div",Z,[e("ul",ee,[(l(!0),a(E,null,K(p.value,(o,C)=>(l(),a("li",{key:o.id},[e("label",te,[e("input",{class:"todoList_input",type:"checkbox",value:"true",onClick:B=>A(o.id),checked:o.status},null,8,se),e("span",null,u(o.content),1)]),e("button",{onClick:B=>b(o.id)},ie,8,oe)]))),128))]),i.value==="unfinished"?(l(),a("div",ae,[e("p",null," 總共有"+u(f.value)+" 個未完成項目",1)])):i.value==="done"?(l(),a("div",le,[e("p",null," 總共有"+u(p.value.length-f.value)+" 個已完成項目",1)])):(l(),a("div",re,[e("p",null," 總共有"+u(f.value)+" 個未完成項目",1),e("p",null," 總共有"+u(p.value.length-f.value)+" 個已完成項目",1)]))])]))])])]))}};export{de as default};
